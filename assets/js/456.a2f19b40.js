(window.webpackJsonp=window.webpackJsonp||[]).push([[456],{2234:function(a,t,s){"use strict";s.r(t);var n=s(54),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#_1、需求"}},[a._v("1、需求")])]),s("li",[s("a",{attrs:{href:"#_2、设置"}},[a._v("2、设置")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1-transactional注解中的设置"}},[a._v("①@Transactional注解中的设置")])]),s("li",[s("a",{attrs:{href:"#_2dao方法中让线程睡眠"}},[a._v("②Dao方法中让线程睡眠")])]),s("li",[s("a",{attrs:{href:"#_3执行效果"}},[a._v("③执行效果")])])])])])]),s("p"),a._v(" "),s("h1",{attrs:{id:"实验四-事务属性-超时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验四-事务属性-超时"}},[a._v("#")]),a._v(" 实验四 事务属性：超时")]),a._v(" "),s("h2",{attrs:{id:"_1、需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、需求"}},[a._v("#")]),a._v(" 1、需求")]),a._v(" "),s("p",[a._v("事务在执行过程中，有可能因为遇到某些问题，导致程序卡住，从而长时间占用数据库资源。而长时间占用资源，大概率是因为程序运行出现了问题（可能是Java程序或MySQL数据库或网络连接等等）。")]),a._v(" "),s("p",[a._v("此时这个很可能出问题的程序应该被回滚，撤销它已做的操作，事务结束，把资源让出来，让其他正常程序可以执行。")]),a._v(" "),s("p",[a._v("概括来说就是一句话：超时回滚，释放资源。")]),a._v(" "),s("h2",{attrs:{id:"_2、设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置"}},[a._v("#")]),a._v(" 2、设置")]),a._v(" "),s("h3",{attrs:{id:"_1-transactional注解中的设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-transactional注解中的设置"}},[a._v("#")]),a._v(" ①@Transactional注解中的设置")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("readOnly "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" timeout "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateTwice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 修改员工姓名的一组参数")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" empId4EditName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" newName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 修改员工工资的一组参数")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" empId4EditSalary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Double")]),a._v(" newSalary\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 为了测试事务是否生效，执行两个数据库操作，看它们是否会在某一个失败时一起回滚")]),a._v("\n    empDao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateEmpNameById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("empId4EditName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" newName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    empDao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateEmpSalaryById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("empId4EditSalary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" newSalary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h3",{attrs:{id:"_2dao方法中让线程睡眠"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2dao方法中让线程睡眠"}},[a._v("#")]),a._v(" ②Dao方法中让线程睡眠")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateEmpSalaryById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" empId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Double")]),a._v(" salary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("SECONDS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("InterruptedException")]),a._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 为了看到操作失败后的效果人为将 SQL 语句破坏")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"update t_emp set emp_salary=? where emp_id=?"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    jdbcTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" salary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" empId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("PS：注意：sleep操作如果放在执行 SQL 语句后面那就不起作用。")])]),a._v(" "),s("h3",{attrs:{id:"_3执行效果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3执行效果"}},[a._v("#")]),a._v(" ③执行效果")]),a._v(" "),s("p",[a._v("执行过程中日志和抛出异常的情况：")]),a._v(" "),s("blockquote",[s("p",[a._v("[16:25:41.706] [DEBUG] [main] [org.springframework.jdbc.datasource.DataSourceTransactionManager] [Initiating transaction rollback]\n[16:25:41.706] [DEBUG] [main] [org.springframework.jdbc.datasource.DataSourceTransactionManager] [Rolling back JDBC transaction on Connection [com.mysql.jdbc.JDBC4Connection@53b7f657]]\n[16:25:41.709] [DEBUG] [main] [org.springframework.jdbc.datasource.DataSourceTransactionManager] [Releasing JDBC Connection [com.mysql.jdbc.JDBC4Connection@53b7f657] after transaction]")]),a._v(" "),s("p",[a._v("org.springframework.transaction."),s("span",{staticStyle:{color:"blue","font-weight":"bold"}},[a._v("TransactionTimedOutException")]),a._v(": Transaction timed out: deadline was Fri Jun 04 16:25:39 CST 2021")])]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03/experiment03.html"}},[a._v("上一个实验")]),a._v(" "),s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03.html"}},[a._v("回目录")]),a._v(" "),s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03/experiment05.html"}},[a._v("下一个实验")])],1)])}),[],!1,null,null,null);t.default=e.exports}}]);