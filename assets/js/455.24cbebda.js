(window.webpackJsonp=window.webpackJsonp||[]).push([[455],{2233:function(a,t,s){"use strict";s.r(t);var n=s(54),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#_1、介绍"}},[a._v("1、介绍")])]),s("li",[s("a",{attrs:{href:"#_2、设置方式"}},[a._v("2、设置方式")])]),s("li",[s("a",{attrs:{href:"#_3、针对增删改操作设置只读"}},[a._v("3、针对增删改操作设置只读")])]),s("li",[s("a",{attrs:{href:"#_4、-transactional-注解放在类上"}},[a._v("4、@Transactional 注解放在类上")]),s("ul",[s("li",[s("a",{attrs:{href:"#_1生效原则"}},[a._v("①生效原则")])]),s("li",[s("a",{attrs:{href:"#_2用法举例"}},[a._v("②用法举例")])])])])])]),s("p"),a._v(" "),s("h1",{attrs:{id:"实验三-事务属性-只读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验三-事务属性-只读"}},[a._v("#")]),a._v(" 实验三 事务属性：只读")]),a._v(" "),s("h2",{attrs:{id:"_1、介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、介绍"}},[a._v("#")]),a._v(" 1、介绍")]),a._v(" "),s("p",[a._v("对一个查询操作来说，如果我们把它设置成只读，就能够明确告诉数据库，这个操作不涉及写操作。这样数据库就能够针对查询操作来进行优化。")]),a._v(" "),s("h2",{attrs:{id:"_2、设置方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置方式"}},[a._v("#")]),a._v(" 2、设置方式")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// readOnly = true把当前事务设置为只读")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("readOnly "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getEmpName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" empId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" empDao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("selectEmpNameById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("empId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"_3、针对增删改操作设置只读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、针对增删改操作设置只读"}},[a._v("#")]),a._v(" 3、针对增删改操作设置只读")]),a._v(" "),s("p",[a._v("会抛出下面异常：")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed")])]),a._v(" "),s("h2",{attrs:{id:"_4、-transactional-注解放在类上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、-transactional-注解放在类上"}},[a._v("#")]),a._v(" 4、@Transactional 注解放在类上")]),a._v(" "),s("h3",{attrs:{id:"_1生效原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1生效原则"}},[a._v("#")]),a._v(" ①生效原则")]),a._v(" "),s("p",[a._v("如果一个类中每一个方法上都使用了 @Transactional 注解，那么就可以将 @Transactional 注解提取到类上。反过来说：@Transactional 注解在类级别标记，会影响到类中的每一个方法。同时，类级别标记的 @Transactional 注解中设置的事务属性也会延续影响到方法执行时的事务属性。除非在方法上又设置了 @Transactional 注解。")]),a._v(" "),s("p",[a._v("对一个方法来说，离它最近的 @Transactional 注解中的事务属性设置生效。")]),a._v(" "),s("h3",{attrs:{id:"_2用法举例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2用法举例"}},[a._v("#")]),a._v(" ②用法举例")]),a._v(" "),s("p",[a._v("在类级别@Transactional注解中设置只读，这样类中所有的查询方法都不需要设置@Transactional注解了。因为对查询操作来说，其他属性通常不需要设置，所以使用公共设置即可。")]),a._v(" "),s("p",[a._v("然后在这个基础上，对增删改方法设置@Transactional注解 readOnly 属性为 false。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("readOnly "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EmpService")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 为了便于核对数据库操作结果，不要修改同一条记录")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Transactional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("readOnly "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateTwice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("……"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t\t……\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// readOnly = true把当前事务设置为只读")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// @Transactional(readOnly = true)")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getEmpName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" empId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t\t……\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br")])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("PS：Spring 环境下很多场合都有类似设定，一个注解如果标记了类的每一个方法那么通常就可以提取到类级别。")])]),a._v(" "),s("p",[s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03/experiment02.html"}},[a._v("上一个实验")]),a._v(" "),s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03.html"}},[a._v("回目录")]),a._v(" "),s("RouterLink",{attrs:{to:"/pro004-Spring/lecture/chapter03/verse03/experiment04.html"}},[a._v("下一个实验")])],1)])}),[],!1,null,null,null);t.default=e.exports}}]);