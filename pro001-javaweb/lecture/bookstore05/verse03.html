<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>代码重工</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="代码重工">
    
    <link rel="preload" href="/code_heavy_industry/assets/css/0.styles.f7de6701.css" as="style"><link rel="preload" href="/code_heavy_industry/assets/js/app.972bd0f0.js" as="script"><link rel="preload" href="/code_heavy_industry/assets/js/4.904e76b5.js" as="script"><link rel="preload" href="/code_heavy_industry/assets/js/30.64f9cad0.js" as="script"><link rel="prefetch" href="/code_heavy_industry/assets/js/1.d66e04b2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/10.7093d550.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/100.384331b2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/101.582f78e7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/102.17f2c0ec.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/103.a530857d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/104.62821ce1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/105.11cdcc82.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/106.d57c1e75.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/107.7ebeb306.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/108.c067b47b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/109.9495d2ca.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/11.acc2935e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/110.7f58dbd3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/111.f78239ff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/112.8eb72445.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/113.3f5aff71.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/114.9f65cf57.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/115.dcaea004.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/116.726c5aac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/117.54d6c26a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/118.3f4e0bda.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/119.95ed5dc6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/12.a5354f50.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/120.4fd08fac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/121.f4aadbe5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/122.d588a1e0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/123.781e7192.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/124.ed312291.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/125.bceffbb9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/126.51bf552f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/127.4800687b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/128.fcdd6f2a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/129.2a25d78a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/13.88a0c565.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/130.dcfe7623.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/131.c29e7c45.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/132.9a412a4b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/133.615218d5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/134.2168ca5a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/135.a5e262ff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/136.7dba5235.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/137.445576e7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/138.577b3f66.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/139.b646f1ac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/14.36391765.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/140.52abf81e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/141.807c626b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/142.adf9e127.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/143.9773d979.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/144.5658ae76.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/145.2d2fb13b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/146.0e322019.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/147.50b34ac1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/148.463aab7c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/149.9bd7c539.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/15.4a8e9d28.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/150.9449ca28.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/151.1961c6db.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/152.18709656.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/153.a4bf78f6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/154.6c90b1d5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/155.024247e2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/156.76281b57.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/157.a7c02212.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/158.0d00acef.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/159.9180c937.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/16.87793b5d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/160.d7a98288.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/161.389ddf84.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/162.ab22d7dc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/163.087257c6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/164.addfc5af.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/165.f90e6b2a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/166.fa06e4b6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/167.a00e722b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/168.e3855223.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/169.e0c63a4e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/17.dec86310.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/170.7c5835f4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/171.7d9ae110.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/172.4da5caea.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/173.f8ac6155.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/174.3b831765.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/175.01782f3d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/176.6eab6644.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/177.86339767.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/178.c437c804.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/179.927227c9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/18.9167733d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/180.caa2c660.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/181.c186b8ac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/182.0475844f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/183.2c5950c8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/184.82b336f6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/185.e2d4a46e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/186.99a3de8a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/187.d557500c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/188.e81bd251.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/189.d07d368a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/19.017b4ad0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/190.173606ea.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/191.c5ac0c71.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/192.127d6d93.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/193.2f9011c9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/194.14f534a3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/195.65939036.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/196.6e3cf025.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/197.4d18b1d7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/198.c2e521c3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/199.d72c63dd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/20.6aa686d0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/200.56d7dbd3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/201.c72a395d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/202.cb32f7af.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/203.285e6b92.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/204.ead50027.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/205.190c1baf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/206.4dab4ba0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/207.f11eee48.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/208.e2f8ca82.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/209.e7e74aff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/21.f7d66fe8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/210.69c4a0ed.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/211.a1ab5062.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/212.6d0473bd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/213.bd120419.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/214.c7d4362c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/215.8adc34dc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/216.abf8ff23.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/217.10f9fc46.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/218.52e31fec.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/219.ea0551af.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/22.b1de9b18.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/220.6be520c8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/221.c0d93576.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/222.1bb0eaff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/223.8492b065.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/224.5897434e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/225.51902428.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/226.9da70eee.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/227.9e113839.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/228.d689b27d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/229.28f74090.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/23.e3b58d3d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/230.465a35a0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/231.219aeb63.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/232.84035c50.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/233.ef27424d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/234.5dcf1349.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/235.bcc0c537.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/236.9bb64465.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/237.f3300514.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/238.ca7af9ac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/239.fdfe2127.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/24.2e010582.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/240.8a4488af.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/241.9987dfab.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/242.819ed984.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/243.bf129ecd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/244.030b4b49.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/245.7663f620.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/246.ed2b2fc0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/247.54dd84f1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/248.a1c69038.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/249.47dd7b3b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/25.a5f2f737.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/250.ec8017a5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/251.89ab0cf7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/252.5ec1eea4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/253.31a37280.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/254.fcfabb55.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/255.286f4c17.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/256.ce77595b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/257.cb3677c0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/258.ca18e0e9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/259.65dc8492.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/26.cce346fc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/260.475ddaba.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/261.643b784a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/262.e5092c67.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/263.5e85d32e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/264.6ff4b789.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/265.fee7416a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/266.8d8a5e44.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/267.8c62a655.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/268.762073ff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/269.ffe69921.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/27.22790cda.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/270.d5bf783f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/271.83fd2f70.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/272.6de67fa9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/273.628e1b77.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/274.7f0d82c6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/275.d4478098.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/276.56649e5b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/277.05b881f2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/278.c079de28.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/279.58101972.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/28.ac0ba3fa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/280.5e32c770.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/281.59fb6cf4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/282.f22da512.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/283.db103d63.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/284.a373c7e0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/285.55c6f720.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/286.f924c38c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/287.52a35525.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/288.dcc32270.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/289.835ad2b5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/29.6e1dc238.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/290.749e38a9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/291.90916822.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/292.b453b275.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/293.11ad0754.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/294.dddc45b9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/295.74ecca38.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/296.2061efa6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/297.b838fcd5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/298.8c08be1f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/299.5a99490b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/3.9ca9fb75.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/300.a5010762.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/301.a2f8795a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/302.129bdff3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/303.57268b2c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/304.5556b94f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/305.72bbf9b8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/306.821163a7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/307.b85ceac7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/308.7f794216.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/309.212b7a1d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/31.386297cc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/310.089b4a08.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/311.c7f6aabd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/312.810271c0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/313.030424f0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/314.a95451b6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/315.f883b88e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/316.676ed945.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/317.0dcbeaef.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/318.bd172af6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/319.e2d01ca1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/32.8927ba28.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/320.09b01482.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/321.3b70dce2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/322.5f7046ad.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/323.ffd56783.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/324.cfe0b188.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/325.cc2f1112.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/326.635a861b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/327.94eacc0e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/328.7d4790fb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/329.38f7ef56.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/33.bd1f28e6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/330.269edfe2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/331.21623a36.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/332.1f1c659c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/333.fe34384d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/334.34a514a7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/335.9272b0cc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/336.796dcaf9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/337.bfd29430.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/338.fdb020fd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/339.d7f19890.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/34.36a2460a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/340.b22b3f52.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/341.47e1d3f4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/342.38ca17d1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/343.2e7874e5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/344.6697aea1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/345.ad3be23a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/346.d40fa749.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/347.881934aa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/348.2e8d29b9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/349.87f51cb4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/35.80f36815.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/350.06081b68.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/351.f883c9ae.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/352.8fcd0728.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/353.2dd787b0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/354.689db664.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/355.b9a083ea.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/356.3eaa4bf3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/357.2f05ac11.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/358.c6777610.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/359.2ae0c8ac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/36.f9bba134.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/360.c9811603.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/361.5c3068d4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/362.a80ddcc6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/363.ccbb8d6e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/364.8da5de40.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/365.0d9f6c8a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/366.e410e582.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/367.f8689b17.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/368.57119763.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/369.f92c7aed.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/37.8935c848.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/370.8e896c3a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/371.e2565759.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/372.0028b0ce.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/373.82bfe997.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/374.434f814f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/375.8478c681.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/376.998ce2de.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/377.670e9be5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/378.c9cfc01b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/379.0aacc719.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/38.86fba1a7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/380.14a91411.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/381.9e783c93.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/382.cf2ffc03.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/383.c32b0740.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/384.4280025f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/385.a816d541.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/386.1d8fc395.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/387.bc22626f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/388.1cf59352.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/389.a09795bf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/39.c8c0ff8e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/390.6a223692.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/391.733d45f0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/392.d76fd3df.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/393.c885df90.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/394.c344d389.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/395.687cbd0a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/396.57e0df54.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/397.1a31ad36.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/398.59535325.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/399.0a11557f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/40.c0f7e504.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/400.7b2afabb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/401.4b72ea6e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/402.b94737bf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/403.a838c189.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/404.9a221abc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/405.f8f3b954.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/406.2de8752c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/407.eb35a188.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/408.47acaedf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/409.aa2afaca.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/41.e7e858c4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/410.722e5009.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/411.2dbe321f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/412.39ed2d1e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/413.a088f973.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/414.87f8d239.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/415.f90a1394.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/416.ea4ba38d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/417.8a1c9676.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/418.79315748.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/419.1e3ddf12.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/42.8202bb44.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/420.b6d9e0cb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/421.0c74ef64.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/422.94c20620.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/423.fa0d6946.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/424.9036ac4f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/425.8d8e82da.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/426.03b7da89.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/427.e3c8c690.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/428.96fdfdce.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/429.a8863be5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/43.55e30ded.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/430.305aa090.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/431.e02d3725.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/432.83fa148f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/433.1f01715d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/434.f3354ec6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/435.245644ed.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/436.3c933a14.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/437.b62325fb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/438.8e122783.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/439.e95fa7e6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/44.e5c90e7a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/440.5c168090.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/441.f8835ac7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/442.cf1de5dc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/443.50ec8b3c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/444.1600e74f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/445.795f336d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/446.1fb71b0f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/447.0136df19.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/448.abf11aa4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/449.4f99bee8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/45.89368cde.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/450.55da381a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/451.97a68e8d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/452.9dd8c55e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/453.3167da0d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/454.18fad993.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/455.24cbebda.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/456.a2f19b40.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/457.27f4fb5a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/458.29941084.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/459.b0cc6f89.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/46.1f553681.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/460.86ef4965.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/461.c0b0f695.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/462.8b86c3a9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/463.79aadbb4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/464.9735f749.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/465.4bdede2b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/466.ef630311.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/467.8664e027.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/468.89b3d4ff.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/469.74e0af2c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/47.5f78034c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/470.9643f84e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/471.e3a1e16a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/472.116791e2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/473.3bb6cb3d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/474.1a7a0724.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/475.76c29d71.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/476.fe1fd93a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/477.e3f203de.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/478.b34f8b1c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/479.06d48874.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/48.0c8a5846.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/480.ffc77ad4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/481.2475d5aa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/482.5da370b4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/483.2531f6c1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/484.3f8b3ccf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/485.fb51e0ee.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/486.881d8443.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/487.36a959cb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/488.086e154c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/489.2afd2906.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/49.40a46041.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/490.a517239f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/491.c1f416dd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/492.e36de27b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/493.af28d057.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/494.00509c64.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/495.8ed86db6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/496.412e9f2d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/497.ed9f0eeb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/498.2112afec.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/499.743df60a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/5.6f1dbbc3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/50.54de97a0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/500.ab62befa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/501.0d54ba9a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/502.2f3bf836.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/503.c3473b0e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/504.cb511490.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/505.a2cc8bdc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/506.f8ea663a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/507.9cc67e94.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/508.e08708a1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/509.437502c3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/51.af5d6a98.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/510.f5e8a583.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/511.6fe511a5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/512.459d2d68.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/513.a5f4a768.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/514.5fd44c68.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/515.c046ffb4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/516.a972f386.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/517.7c804920.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/518.ff4a2545.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/519.b1a8d590.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/52.b766b60a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/520.2d34cada.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/521.f14247fe.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/522.38b72172.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/523.203fa4ac.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/524.236cda03.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/525.8caaad18.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/526.9a217f1e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/527.06dc5a4f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/528.fa884c79.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/529.d39c75ca.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/53.eae65ff7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/530.65b18758.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/531.85af388d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/532.9d3f253a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/533.77c2fa0b.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/534.924b0eb2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/535.5854a4b0.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/536.8b57b538.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/537.ccb7ba0f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/538.b9c6c631.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/539.63164d8a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/54.9b89b352.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/540.7e721167.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/541.0cd3f048.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/542.6c5df759.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/543.e1eebdf2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/544.a3042061.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/545.1a468f89.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/546.892c1841.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/547.c6b5ef7e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/548.19d884b6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/549.7c34a773.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/55.b8a1964e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/550.25f7d121.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/551.b9f92580.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/552.bf452147.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/553.4815ac56.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/554.c253ebb4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/555.4dbef2bf.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/556.69f1a9f4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/557.679e8f40.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/558.9515c7f8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/559.eb17cff7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/56.88fa6666.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/560.0de96a04.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/561.cdf49465.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/562.2e895986.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/563.40a31d36.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/564.08f15bf2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/565.e7625c6a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/566.71ee556d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/567.7b3e4bc8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/568.1a3c07dc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/569.4c496338.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/57.519e80e3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/570.d152813e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/571.e46946bd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/572.ae215a0d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/573.da7b2e6c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/574.f068c09e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/575.f2a128db.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/576.caf5cd68.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/577.b6c04041.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/578.a7707d73.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/579.ed17d056.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/58.963c2309.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/580.88a2ce36.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/581.f99a65fa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/582.220ce66c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/583.5d42e8cc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/584.0737b3ce.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/585.516b187d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/586.420c42c4.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/587.e3deb3dd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/588.c9bfc1e3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/589.ee0f90f3.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/59.d9b10f83.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/590.ea859bba.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/591.4b9781fd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/592.c9da8cab.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/6.064acd80.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/60.7e89993c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/61.f2039f26.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/62.474d18a7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/63.3a64d334.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/64.4a3787c2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/65.120ee13f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/66.e7ff207d.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/67.55a68541.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/68.33f8c7cd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/69.69d65c56.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/7.ce2273f5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/70.93a544a5.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/71.6eb8d306.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/72.8cbae6a9.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/73.c737f071.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/74.d0ea9fc8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/75.2219607f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/76.278079e2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/77.88eadfbc.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/78.257c919e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/79.e6f5d078.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/8.e2571ee7.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/80.40ba7856.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/81.1fab2c8f.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/82.6eaad50e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/83.9f3e6e81.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/84.060f32c2.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/85.c069396c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/86.ced213eb.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/87.763c4879.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/88.69fe1a6a.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/89.b87612a8.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/9.5f2fc60c.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/90.6132ccb6.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/91.27dbc3bd.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/92.88832461.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/93.0166bd69.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/94.e29b12f1.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/95.f1245827.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/96.9c45438e.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/97.e8783a06.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/98.60628afa.js"><link rel="prefetch" href="/code_heavy_industry/assets/js/99.b3cb9d0f.js">
    <link rel="stylesheet" href="/code_heavy_industry/assets/css/0.styles.f7de6701.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/code_heavy_industry/" class="home-link router-link-active"><!----> <span class="site-name">代码重工</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1、事务回顾">1、事务回顾</a><ul><li><a href="#_1acid属性">①ACID属性</a></li><li><a href="#_2隔离级别">②隔离级别</a></li></ul></li><li><a href="#_2、jdbc事务控制">2、JDBC事务控制</a><ul><li><a href="#_1同一个数据库连接">①同一个数据库连接</a></li><li><a href="#_2关闭事务的自动提交">②关闭事务的自动提交</a></li><li><a href="#_3提交事务">③提交事务</a></li><li><a href="#_4回滚事务">④回滚事务</a></li><li><a href="#_5事务整体的代码块">⑤事务整体的代码块</a></li></ul></li><li><a href="#_3、将事务对接到书城项目中">3、将事务对接到书城项目中</a><ul><li><a href="#_1三层架构中事务要对接的位置">①三层架构中事务要对接的位置</a></li><li><a href="#_2假想">②假想</a></li><li><a href="#_3假想代码的缺陷">③假想代码的缺陷</a></li><li><a href="#_4事务代码抽取">④事务代码抽取</a></li><li><a href="#_5在filter中获取数据库连接">⑤在Filter中获取数据库连接</a></li><li><a href="#_6保证所有数据库操作使用同一个连接">⑥保证所有数据库操作使用同一个连接</a></li><li><a href="#_7线程本地化">⑦线程本地化</a></li><li><a href="#_8异常向上抛出的线路">⑧异常向上抛出的线路</a></li></ul></li><li><a href="#_4、代码实现">4、代码实现</a><ul><li><a href="#_1重构jdbcutils类">①重构JDBCUtils类</a></li><li><a href="#_2重构basedao">②重构BaseDao</a></li><li><a href="#_3创建一个用于显示通用错误信息的页面">③创建一个用于显示通用错误信息的页面</a></li><li><a href="#_4创建transactionfilter">④创建TransactionFilter</a></li></ul></li></ul></div><p></p> <h1 id="第三节-结账过程中使用事务-重要"><a href="#第三节-结账过程中使用事务-重要" class="header-anchor">#</a> 第三节 结账过程中使用事务（重要）</h1> <h2 id="_1、事务回顾"><a href="#_1、事务回顾" class="header-anchor">#</a> 1、事务回顾</h2> <h3 id="_1acid属性"><a href="#_1acid属性" class="header-anchor">#</a> ①ACID属性</h3> <ul><li><p>A：原子性 事务中包含的数据库操作缺一不可，整个事务是不可再分的。</p></li> <li><p>C：一致性 事务执行之前，数据库中的数据整体是正确的；事务执行之后，数据库中的数据整体仍然是正确的。</p> <ul><li>事务执行成功：提交（commit）</li> <li>事务执行失败：回滚（rollback）</li></ul></li> <li><p>I：隔离性 数据库系统同时执行很多事务时，各个事务之间基于不同隔离级别能够在一定程度上做到互不干扰。简单说就是：事务在并发执行过程中彼此隔离。</p></li> <li><p>D：持久性 事务一旦提交，就永久保存到数据库中，不可撤销。</p></li></ul> <h3 id="_2隔离级别"><a href="#_2隔离级别" class="header-anchor">#</a> ②隔离级别</h3> <h4 id="_1-并发问题"><a href="#_1-并发问题" class="header-anchor">#</a> [1]并发问题</h4> <table><thead><tr><th>并发问题</th> <th>问题描述</th></tr></thead> <tbody><tr><td>脏读</td> <td>当前事务读取了其他事务尚未提交的修改<br>如果那个事务回滚，那么当前事务读取到的修改就是错误的数据</td></tr> <tr><td>不可重复读</td> <td>当前事务读取同一个数据，第一次和第二次不一致</td></tr> <tr><td>幻读</td> <td>当前事务在执行过程中，数据库表增减或减少了一些记录，感觉像是出现了幻觉</td></tr></tbody></table> <h4 id="_2-隔离级别"><a href="#_2-隔离级别" class="header-anchor">#</a> [2]隔离级别</h4> <table><thead><tr><th>隔离级别</th> <th>描述</th> <th>能解决的并发问题</th></tr></thead> <tbody><tr><td>读未提交</td> <td>允许当前事务读取其他事务尚未提交的修改</td> <td>啥问题也解决不了</td></tr> <tr><td>读已提交</td> <td>允许当前事务读取其他事务已经提交的修改</td> <td>脏读</td></tr> <tr><td>可重复读</td> <td>当前事务执行时锁定当前记录，不允许其他事务操作</td> <td>脏读、不可重复读</td></tr> <tr><td>串行化</td> <td>当前事务执行时锁定当前表，不允许其他事务操作</td> <td>脏读、不可重复读、幻读</td></tr></tbody></table> <h2 id="_2、jdbc事务控制"><a href="#_2、jdbc事务控制" class="header-anchor">#</a> 2、JDBC事务控制</h2> <h3 id="_1同一个数据库连接"><a href="#_1同一个数据库连接" class="header-anchor">#</a> ①同一个数据库连接</h3> <p><img src="data:image/png;base64,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" alt="./images"></p> <h3 id="_2关闭事务的自动提交"><a href="#_2关闭事务的自动提交" class="header-anchor">#</a> ②关闭事务的自动提交</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3提交事务"><a href="#_3提交事务" class="header-anchor">#</a> ③提交事务</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4回滚事务"><a href="#_4回滚事务" class="header-anchor">#</a> ④回滚事务</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>connection<span class="token punctuation">.</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5事务整体的代码块"><a href="#_5事务整体的代码块" class="header-anchor">#</a> ⑤事务整体的代码块</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
    
    <span class="token comment">// 关闭事务的自动提交</span>
    connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 事务中包含的所有数据库操作</span>
    
    <span class="token comment">// 提交事务</span>
    connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Excetion</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    
    <span class="token comment">// 回滚事务</span>
    connection<span class="token punctuation">.</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
    
    <span class="token comment">// 释放数据库连接</span>
    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_3、将事务对接到书城项目中"><a href="#_3、将事务对接到书城项目中" class="header-anchor">#</a> 3、将事务对接到书城项目中</h2> <h3 id="_1三层架构中事务要对接的位置"><a href="#_1三层架构中事务要对接的位置" class="header-anchor">#</a> ①三层架构中事务要对接的位置</h3> <p>从逻辑上来说，一个事务对应一个业务方法（Service层的一个方法）。</p> <p><img src="data:image/png;base64,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" alt="./images"></p> <h3 id="_2假想"><a href="#_2假想" class="header-anchor">#</a> ②假想</h3> <p>每一个Service方法内部，都套用了事务操作所需要的try...catch...finally块。</p> <h3 id="_3假想代码的缺陷"><a href="#_3假想代码的缺陷" class="header-anchor">#</a> ③假想代码的缺陷</h3> <ul><li>会出现大量的冗余代码：我们希望能够抽取出来，只写一次</li> <li>对核心业务功能是一种干扰：我们希望能够在编写业务逻辑代码时专注于业务本身，而不必为辅助性质的套路代码分心</li> <li>将持久化层对数据库的操作写入业务逻辑层，是对业务逻辑层的一种污染，导致持久化层和业务逻辑层耦合在一起</li></ul> <h3 id="_4事务代码抽取"><a href="#_4事务代码抽取" class="header-anchor">#</a> ④事务代码抽取</h3> <ul><li>只要是Filter拦截到的请求都会从doFilter()方法经过</li> <li>chain.doFilter(req, resp);可以包裹住将来要执行的所有方法</li> <li>事务操作的try...catch...finally块只要把chain.doFilter(req, resp)包住，就能够包住将来要执行的所有方法</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token keyword">try</span><span class="token punctuation">{</span>
    
        <span class="token comment">// 关闭事务的自动提交</span>
        connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 『事务中包含的所有数据库操作』就在chain.doFilter(req, resp);将来要调用的方法中</span>
        <span class="token comment">// 所以用事务的try...catch...finally块包住chain.doFilter(req, resp);</span>
        <span class="token comment">// 就能让所有事务方法都『享受』到事务功能的『服务』。</span>
        <span class="token comment">// 所谓框架其实就是把常用的『套路代码』抽取出来，为大家服务，我们享受框架服务提高开发效率。</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 提交事务</span>
        connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Excetion</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// 回滚事务</span>
        connection<span class="token punctuation">.</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>

        <span class="token comment">// 释放数据库连接</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_5在filter中获取数据库连接"><a href="#_5在filter中获取数据库连接" class="header-anchor">#</a> ⑤在Filter中获取数据库连接</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token keyword">try</span><span class="token punctuation">{</span>
        
        <span class="token comment">// 获取数据库连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 关闭事务的自动提交</span>
        connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 『事务中包含的所有数据库操作』就在chain.doFilter(req, resp);将来要调用的方法中</span>
        <span class="token comment">// 所以用事务的try...catch...finally块包住chain.doFilter(req, resp);</span>
        <span class="token comment">// 就能让所有事务方法都『享受』到事务功能的『服务』。</span>
        <span class="token comment">// 所谓框架其实就是把常用的『套路代码』抽取出来，为大家服务，我们享受框架服务提高开发效率。</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 提交事务</span>
        connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Excetion</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// 回滚事务</span>
        connection<span class="token punctuation">.</span><span class="token function">rollBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>

        <span class="token comment">// 释放数据库连接</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_6保证所有数据库操作使用同一个连接"><a href="#_6保证所有数据库操作使用同一个连接" class="header-anchor">#</a> ⑥保证所有数据库操作使用同一个连接</h3> <p><span style="color:blue;font-weight:bold;">『重要发现』</span>：在书城项目中所有执行SQL语句的代码都是通过<span style="color:blue;font-weight:bold;">JDBCUtils.getConnection()</span>方法获取数据库连接。所以我们可以通过<span style="color:blue;font-weight:bold;">重构JDBCUtils.getConnection()</span>方法实现：所有数据库操作使用同一个连接。</p> <p><img src="/code_heavy_industry/assets/img/img009.b3dce48d.png" alt="./images"></p> <h4 id="_1-从数据源中只拿出一个"><a href="#_1-从数据源中只拿出一个" class="header-anchor">#</a> [1]从数据源中只拿出一个</h4> <p>为了保证各个需要Connection对象的地方使用的都是同一个对象，我们从数据源中只获取一个Connection。不是说整个项目只用一个Connection，而是说调用JDBCUtils.getConnection()方法时，只使用一个。所以落实到代码上就是：每次调用getConnection()方法时先检查是否已经拿过了，拿过就给旧的，没拿过给新的。</p> <h4 id="_2-公共区域"><a href="#_2-公共区域" class="header-anchor">#</a> [2]公共区域</h4> <p>为了保证各个方法中需要Connection对象时都能拿到同一个对象，需要做到：将唯一的对象存入一个大家都能接触到的地方。</p> <p><img src="/code_heavy_industry/assets/img/img010.b89a0f0a.png" alt="./images"></p> <p><span style="color:blue;font-weight:bold;">结论</span>：使用<span style="color:blue;font-weight:bold;">线程本地化</span>技术实现Connection对象从上到下传递。</p> <h3 id="_7线程本地化"><a href="#_7线程本地化" class="header-anchor">#</a> ⑦线程本地化</h3> <h4 id="_1-确认同一个线程"><a href="#_1-确认同一个线程" class="header-anchor">#</a> [1]确认同一个线程</h4> <p>在从Filter、Servlet、Service一直到Dao运行的过程中，我们始终都没有做类似new Thread().start()这样开启新线程的操作，所以整个过程在同一个线程中。</p> <h4 id="_2-一条小河"><a href="#_2-一条小河" class="header-anchor">#</a> [2]一条小河</h4> <p><img src="/code_heavy_industry/assets/img/img011.99cf673d.png" alt="./images"></p> <h4 id="_3-一个线程"><a href="#_3-一个线程" class="header-anchor">#</a> [3]一个线程</h4> <p><img src="/code_heavy_industry/assets/img/img012.85a397be.png" alt="./images"></p> <h4 id="_4-代码"><a href="#_4-代码" class="header-anchor">#</a> [4]代码</h4> <p>java.lang.ThreadLocal的set()方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>java.lang.TheadLocal的get()方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ThreadLocalMap<span class="token punctuation">.</span>Entry</span> e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>所以TheadLocal的基本原理是：它在内部维护了一个Map，需要存入数据时，就以this为键，要存入的数据为值，存入Map。需要取出数据时，就以this为键，从Map中取出数据。</p> <h4 id="_5-结论"><a href="#_5-结论" class="header-anchor">#</a> [5]结论</h4> <p>如果我们需要将数据在整个项目中按照<span style="color:blue;font-weight:bold;">从上到下</span>的方式传递，但是又<span style="color:blue;font-weight:bold;">没法通过方法的参数</span>来实现，这时使用线程本地化技术是一个非常好的选择。</p> <h3 id="_8异常向上抛出的线路"><a href="#_8异常向上抛出的线路" class="header-anchor">#</a> ⑧异常向上抛出的线路</h3> <p><img src="/code_heavy_industry/assets/img/img013.97d610ab.png" alt="./images"></p> <p>上图中标记颜色的位置都是有try...catch块的代码，需要逐个检查一下，catch块捕获的异常是否转换为运行时异常又再次抛出。</p> <p>如果没有抛出，异常就不会传递到Filter中，TransactionFilter就会认为代码执行过程中没有发生问题，从而提交事务，但是实际上应该回滚。下面是一个例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 通用的批量增删改方法
 * @param sql
 * @param params 执行批量操作的二维数组
 *               每一条SQL语句的参数是一维数组
 *               多条SQL语句的参数就是二维数组
 * @return 每一条SQL语句返回的受影响的行数
 */</span>
<span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">batchUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowCountArr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        rowCountArr <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">releaseConnection</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> rowCountArr<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_4、代码实现"><a href="#_4、代码实现" class="header-anchor">#</a> 4、代码实现</h2> <h3 id="_1重构jdbcutils类"><a href="#_1重构jdbcutils类" class="header-anchor">#</a> ①重构JDBCUtils类</h3> <ul><li>要点1：将ThreadLocal对象声明为静态成员变量</li> <li>要点2：重构获取数据库连接的方法</li> <li>要点3：重构释放数据库连接的方法</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 功能1：创建数据源对象
 * 功能2：获取数据库连接并绑定到当前线程上
 * 功能3：释放数据库连接并从当前线程移除
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtils</span> <span class="token punctuation">{</span>

    <span class="token comment">// 将数据源对象设置为静态属性，保证大对象的单一实例</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token comment">// 将ThreadLocal对象设置为静态成员变量，保证以此为键时从Map中取值能够取到同一个值</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">&gt;</span></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>

        <span class="token comment">// 1.创建一个用于存储外部属性文件信息的Properties对象</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.使用当前类的类加载器加载外部属性文件：jdbc.properties</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment">// 3.将外部属性文件jdbc.properties中的数据加载到properties对象中</span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 4.创建数据源对象</span>
            dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 从数据源中获取数据库连接
     * @return 数据库连接对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 1.尝试从当前线程获取Connection对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 2.如果从当前线程上没有获取到Connection对象那么从数据源获取</span>
                connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 3.将Connection对象绑定到当前线程</span>
                threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token comment">// 4.返回Connection对象</span>
        <span class="token keyword">return</span> connection<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 释放数据库连接
     * @param connection 要执行释放操作的连接对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">releaseConnection</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 将Connection对象从当前线程移除</span>
                threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h3 id="_2重构basedao"><a href="#_2重构basedao" class="header-anchor">#</a> ②重构BaseDao</h3> <ul><li>要点：去除释放数据库连接的操作（转移到TransactionFilter中）</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 各个具体Dao类的基类，泛型T对应具体实体类类型
 * @param &lt;T&gt;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 通用的批量增删改方法
     * @param sql
     * @param params 执行批量操作的二维数组
     *               每一条SQL语句的参数是一维数组
     *               多条SQL语句的参数就是二维数组
     * @return 每一条SQL语句返回的受影响的行数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">batchUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rowCountArr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            rowCountArr <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">batch</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">/* finally {
            JDBCUtils.releaseConnection(connection);
        }*/</span>

        <span class="token keyword">return</span> rowCountArr<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 通用的增删改方法
     * @param sql 要执行的SQL语句
     * @param param 为SQL语句准备好的参数
     * @return 受影响的行数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> updatedRowCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            updatedRowCount <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">// 为了让上层方法调用方便，将编译时异常捕获</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 为了不掩盖问题，将编译时异常封装为运行时异常抛出</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">/* finally {

            // 关闭数据库连接
            JDBCUtils.releaseConnection(connection);

        }*/</span>

        <span class="token keyword">return</span> updatedRowCount<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询单个对象
     * @param clazz 单个对象所对应的实体类类型
     * @param sql   查询单个对象所需要的SQL语句
     * @param param SQL语句的参数
     * @return      查询到的单个对象
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            t <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">/* finally {

            // 关闭数据库连接
            JDBCUtils.releaseConnection(connection);

        }*/</span>

        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询集合对象
     * @param clazz 集合中单个对象所对应的实体类类型
     * @param sql   查询集合所需要的SQL语句
     * @param param SQL语句的参数
     * @return      查询到的集合对象
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBeanList</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            list <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token comment">/* finally {

            // 关闭数据库连接
            JDBCUtils.releaseConnection(connection);

        }*/</span>

        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br></div></div><p><span style="color:blue;font-weight:bold;">注意</span>：OrderDao中insertOrder()方法也要去掉关闭数据库连接的操作。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// ※DBUtils没有封装获取自增主键的方法，需要我们使用原生的JDBC来完成</span>
    <span class="token comment">// 1.获取数据库连接</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.创建PreparedStatement对象</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;INS222ERT INTO t_order(order_sequence,create_time,total_count,total_amount,order_status,user_id) VALUES(?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>

        <span class="token comment">// ①创建PreparedStatement对象，指明需要自增的主键</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">PreparedStatement</span><span class="token punctuation">.</span>RETURN_GENERATED_KEYS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ②给PreparedStatement对象设置SQL语句的参数</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setDouble</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ③执行更新</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ④获取封装了自增主键的结果集</span>
        <span class="token class-name">ResultSet</span> generatedKeysResultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">getGeneratedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ⑤解析结果集</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>generatedKeysResultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> orderId <span class="token operator">=</span> generatedKeysResultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            order<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">/*finally {
        JDBCUtils.releaseConnection(connection);
    }*/</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_3创建一个用于显示通用错误信息的页面"><a href="#_3创建一个用于显示通用错误信息的页面" class="header-anchor">#</a> ③创建一个用于显示通用错误信息的页面</h3> <h4 id="_1-创建页面"><a href="#_1-创建页面" class="header-anchor">#</a> [1]创建页面</h4> <p>这个页面可以从login_success.html复制过来</p> <p><img src="data:image/png;base64,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" alt="./images"></p> <h4 id="_2-创建servlet跳转到页面"><a href="#_2-创建servlet跳转到页面" class="header-anchor">#</a> [2]创建Servlet跳转到页面</h4> <p><img src="data:image/png;base64,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" alt="./images"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">showSystemError</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> viewName <span class="token operator">=</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">;</span>

    <span class="token function">processTemplate</span><span class="token punctuation">(</span>viewName<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4创建transactionfilter"><a href="#_4创建transactionfilter" class="header-anchor">#</a> ④创建TransactionFilter</h3> <p><img src="data:image/png;base64,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" alt="./images"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>TransactionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>com.atguigu.bookstore.filter.TransactionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>TransactionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Java代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> PUBLIC_STATIC_RESOURCE_EXT_NAME_SET <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;.gif&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token comment">// 排除掉静态资源，它们和数据库操作没有关系</span>
        <span class="token comment">// 1.给请求和响应对象转换类型</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> resp<span class="token punctuation">;</span>

        <span class="token comment">// 2.获取当前请求的ServletPath</span>
        <span class="token class-name">String</span> servletPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.检查servletPath中是否包含“.”</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>servletPath<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">int</span> index <span class="token operator">=</span> servletPath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> extensionName <span class="token operator">=</span> servletPath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>PUBLIC_STATIC_RESOURCE_EXT_NAME_SET<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>extensionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 执行事务操作</span>
        <span class="token comment">// 1.获取数据库连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.使用try...catch...finally块管理事务</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>

            <span class="token comment">// 3.关闭事务的自动提交</span>
            connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 4.尝试执行目标代码</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 5.如果上面的操作没有抛出异常</span>
            connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token comment">// 6.如果上面的操作抛出了异常</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 7.捕获到异常后，跳转到专门的页面显示提示消息</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/ErrorServlet?method=showSystemError&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

            <span class="token comment">// 8.不管前面操作是成功还是失败，到这里都要释放数据库连接</span>
            <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">releaseConnection</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p><a href="/code_heavy_industry/pro001-javaweb/lecture/bookstore05/verse02.html">上一节</a> <a href="/code_heavy_industry/pro001-javaweb/lecture/bookstore05/index.html">回目录</a> <a href="/code_heavy_industry/pro001-javaweb/lecture/bookstore05/verse04.html">下一节</a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/code_heavy_industry/assets/js/app.972bd0f0.js" defer></script><script src="/code_heavy_industry/assets/js/4.904e76b5.js" defer></script><script src="/code_heavy_industry/assets/js/30.64f9cad0.js" defer></script>
  </body>
</html>
